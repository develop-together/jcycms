function viewLayer(a,b,c,d){a||(a=2),0==d.length&&(d={width:"800px",height:"500px"}),layer.open({type:2,title:c.attr("title"),maxmin:!0,shadeClose:!0,area:[d.width,d.height],content:b})}function close_tab(){$(".J_menuTab",parent.document).each(function(a){$(this).hasClass("active")&&($(this).prev("a.J_menuTab").length>0&&$(this).prev("a.J_menuTab").eq(0).addClass("active"),$(this).remove(),parent.$(".J_iframe").eq(a).prev("iframe.J_iframe").length>0&&parent.$(".J_iframe").eq(a).prev("iframe.J_iframe").eq(0).show(),parent.$(".J_iframe").eq(a).remove())})}function showPhotos(a,b){if(!jcms._null($(a).attr("data"))){b=b||5;var c=JSON.parse($(a).attr("data"));layer.photos({photos:c,shift:b})}}function reloadImageList(a,b){var c,d;if(a.parent().attr("class").indexOf("image")>=0){if(!/image\/\w+/.test(b.type))return layer.tips(tips.onlyPictureCanBeSelected,a.parent()),!1;c=new FileReader,c.readAsDataURL(b),d=a.attr("multiple"),c.onload=function(){var g,e="200px",f="200px";$(a).css("max-width")&&(e=$(a).css("max-width")),$(a).css("max-width")&&(f=$(a).css("max-height")),g='<div class="multi-item col-lg-3 col-sm-3 col-md-3"><img class="upload_image_lists img-thumbnail" src="'+this.result+'"></div>',d?g='<div class="multi-item col-lg-3 col-sm-3 col-md-3"><i class="fa fa-trash cancels" style="position: absolute;right:3px;top: -3px;z-index:999;font-size: 14px;color: red;" data-file="'+b.name+'" data-fid=""></i><img class="upload_image_lists img-thumbnail" src="'+this.result+'"></div>':a.parents("div.image").find("div.multi-img-details").empty(),a.parents("div.image").children("img.none_image").remove(),a.parents("div.image").find("div.multi-img-details").append(g),_clickRemoveImg()}}}function _clickRemoveImg(){$("div.multi-img-details").find("i.cancels").bind("click",function(){var e,f,h,i,j,k,b=$(this).data("file"),c=$(this).data("fid"),d=$(this).data("input");if(d=jcms._null(d)?$(this).parent("div").parent("div").parent("div").find("input.feehi_html5_upload").attr("id"):d,e=$("#del_file_"+d),""!=c&&null!=c&&void 0!=c&&"undefined"!=c&&e.val(e.val()+c+","),f=$(this).parent().parent(".multi-img-details").prev(".input-append").find("input.filename_lists"),$(this).parent().parent(".multi-img-details").parent("div.image").find("input.feehi_html5_upload"),h="",f&&b){if(i=f.val()){for(j=i.split("、"),k=0;k<j.length;k++)j[k]!=b&&(h+=j[k]+"、");f.val(h.substring(0,h.length-1))}curFiles&&(curFiles=curFiles.filter(function(a){return a.name!==b}))}$(this).parent().remove()})}function showImage(a){articleShowImgTimer=setTimeout(function(){var b=$(a).attr("title");b.length&&layer.tips('<img src="'+b+'" width="100" height="100">',$(a),{tips:[2,"#3595CC"]})},200)}!function(){var a=function(){this.ajax=function(a,b,c,d,e,f,g,h,i){g=g||3e4,f=f||!0,h=h||!1;var j={type:a,url:b,data:c,async:f,timeout:g,dataType:d,success:function(a){e&&"function"==typeof e&&e(a)},error:function(a,b,c){if(i&&"function"==typeof i)i(a,b,c);else{if("timeout"===b)return swal(tips.error+": "+"timeout!"),void 0;a.responseJSON&&a.responseJSON.hasOwnProperty("message")&&swal(tips.error+": "+a.responseJSON.message,tips.operatingFailed+".","error")}}};"post"==a.toLowerCase()&&("[object FormData]"===Object.prototype.toString.call(c)||h?(c.append("_csrf_backend",$("meta[name='csrf-token']").attr("content")),j["processData"]=!1,j["contentType"]=!1):c._csrf_backend=$("meta[name='csrf-token']").attr("content")),jQuery.ajax(j)},this.callback=function(a,b,c){var d,e,f,g,h;b=!this._null(b)||"ok",c=!this._null(c)||!1,d=[{state:"ok",statusCode:200,message:"操作成功"},{state:"error",statusCode:300,message:"操作失败"},{state:"timeout",statusCode:301,message:"操作超时"}],e=200;for(f in d)b==d[f].state&&(e=d[f].statusCode,a=this._null(a)||d[f].message);g=200==e?1:2,h=layer.alert(a,{icon:g},function(){c&&200==e&&setTimeout(function(){layer.close(h),layer.closeAll("loading")},1e3)})},this._null=function(a){return""==a||null==a||"undefined"==a||"undefined"==typeof a?!0:!1},this.datum={},this.autocomplete=function(a,b){if(!b.data&&b.url){-1==b.url.indexOf("?search=%QUERY")&&(b.url+=-1!=b.url.indexOf("&")?"&keyword=%QUERY%":"?keyword=%QUERY%");var c={datumTokenizer:Bloodhound.tokenizers.obj.whitespace(b.displayKey),queryTokenizer:Bloodhound.tokenizers.whitespace};b.isCache?c.prefetch=b.url:c.remote={url:b.url,wildcard:"%QUERY%"},this.datum=new Bloodhound(c)}else this.datum=new Bloodhound({datumTokenizer:function(a){return a[b.displayKey]},queryTokenizer:Bloodhound.tokenizers.whitespace,local:b.data,identify:function(a){return a[b.valueKey]}});this.datum.initialize(),jQuery(".typeahead-"+a).typeahead({hint:!0,highlight:!0},{name:b.name,displayKey:b.displayKey,limit:parseInt(b.limit),source:baseUtil.nflTeamsWithDefaults}).on("typeahead:select",function(a,c){$("#"+b.selectedDomId).val(c[b.valueKey])}).on("typeahead:asyncrequest",function(){}).on("typeahead:asynccancel typeahead:asyncreceive",function(){})},this.nflTeamsWithDefaults=function(a,b,c){this.datum.search(a,b,c)}},b=new a;window.jcms=b}(window),yii.confirm=function(a,b,c){var d=$(this).attr("href"),e=$(this).attr("data-pjax")?$(this).attr("data-pjax"):0,f=$(this).attr("data-method")?$(this).attr("data-method"):"get";d&&"javascript:;"!=d&&"#"!=d||c(),swal({title:a,text:tips.realyToDo,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",cancelButtonText:tips.cancel,confirmButtonText:tips.ok,closeOnConfirm:!1},function(a){a?parseInt(e)?!b||b():(swal(tips.waitingAndNoRefresh,tips.operating+"...","success"),$.ajax({url:d,dataType:"json",type:f,success:function(a){200==a.code?(swal(tips.success+"!",tips.operatingSuccess+".","success"),location.reload()):swal(tips.error+": "+a.message,tips.operatingFailed+".","error")},error:function(a){swal(tips.error+": "+a.responseJSON.message,tips.operatingFailed+".","error")}})):!c||c()})};var curFiles=[];$(document).ready(function(){var a,b;$(".multi-operate").click(function(){var a=$(this).attr("href"),b=new Array;return $("tr td input[type=checkbox]:checked").each(function(){b.push($(this).val())}),b.length<=0?(swal(tips.noItemSelected,tips.PleaseSelectOne),!1):(b=b.join(","),swal({title:$(this).attr("data-confirm"),text:b,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",cancelButtonText:tips.cancel,confirmButtonText:tips.ok,closeOnConfirm:!1},function(c){return c?(swal(tips.waitingAndNoRefresh,tips.operating+"...","success"),$.ajax({url:a,dataType:"json",type:"get",data:{id:b},success:function(a){200==a.code?(swal(tips.success+"!",tips.operatingSuccess+".","success"),location.reload()):swal(tips.error+": "+a.message,tips.operatingFailed+".","error")},error:function(a){swal(tips.error+": "+a.responseJSON.message,tips.operatingFailed+".","error")}}),void 0):!1}),!1)}),$("a.close-link").click(function(){var a=$(this).parents("div.ibox:first");a.hide(),0==a.length&&($(this).parents("div.ibox-title").hide(),$(this).parents("div.ibox-title:first").next().hide()),$(this).parents("div.ibox:first").hide()}),$("a.collapse-link").click(function(){var b,a=$(this).parents("div.ibox:first").children("div.ibox-content");a.slideToggle(),b=$(this).children("i:first").attr("class"),"fa fa-chevron-up"==b?$(this).children("i:first").attr("class","fa fa-chevron-down"):$(this).children("i:first").attr("class","fa fa-chevron-up"),0==a.length&&$(this).parents("div.ibox-title:first").next().slideToggle()}),_clickRemoveImg(),$("a.refresh").click(function(){return location.reload(),!1}),$(".openContab").click(function(){return parent.openConTab($(this)),!1}),$("div.input-append").bind("click",function(a){var b,c;a.preventDefault(),$("img.upload_image_lists")&&($("img.upload_image_lists").remove(),b="",c=$(this).parents("div.image").children("div.input-append").children("input[type='text']").val(),c&&(b=c+"、"),$(this).parents("div.image").children("div.input-append").children("input[type='text']").val(b.substr(0,b.length-1))),$(this).parent("div").find('input[type="file"]').click()}),$("input.feehi_html5_upload[type=file]").val()&&$("input.feehi_html5_upload[type=file]").val(""),$("input.feehi_html5_upload[type=file]").bind("change",function(){var a,b,c,d,e,f,g;if("undefined"!=typeof FileReader){if(a=$(this),b=$(this)[0].files,c="",d=a.attr("multiple"),e=a.parent("div").find("input.filename_lists").val(),d&&e&&(c=e+"、"),f=null,b){a.parent("div").find("img.none_image").hide(),b&&b.length&&Array.prototype.push.apply(curFiles,b);for(g in b)f=b[g],"object"==typeof f&&(c+=f.name+"、",reloadImageList(a,f))}else a.parent("div").find("img.none_image").show();a.parents("div.image").children("div.input-append").children("input[type='text']").val(c.substr(0,c.length-1))}}),$("div.photos_list").length&&$("div.photos_list").bind("click",function(){showPhotos(this,3)}),a=$(".pjax-reload"),a.length&&(a.on("pjax:beforeSend",function(){}),a.on("pjax:send",function(){layer.load()}),a.on("pjax:complete",function(){layer.closeAll("loading"),$("table tr td a.title").bind("mouseover mouseout",function(){showPhotos(this)})})),$(".clear-search").on("click",function(){var a=$(this).closest("form").attr("action");window.location.href=a}),$("button.ajax-form-submit").bind("click",function(){var d,e,a=$(this).parent().parent().parent("form")[0],b=new FormData(a),c=a.getAttribute("action");if(curFiles&&curFiles.length)for(d=$(a).find("input.feehi_html5_upload"),b.delete(d.attr("name")),e=0;e<curFiles.length;e++)b.append(d.attr("name"),curFiles[e]);jcms.ajax("POST",c,b,"JSON",function(a){return 200==a.statusCode?(layer.msg(a.message,{icon:6}),curFiles=[],setTimeout(function(){location.href=a.href},300)):layer.msg(a.message,{icon:5}),!1},!0,1e4,!0,function(a,b){200!==a.status&&layer.alert(a.status+"<br>"+a.readyState+"<br>"+b,{icon:5})})}),$("table tr td a.title").hover(function(){showImage(this)},function(){clearTimeout(b)}),$(".pjax-refresh").bind("click",function(){var a=$(".pagination").find("li.active > a").attr("href");a?$.pjax.reload(".pjax-reload",{url:a}):$.pjax.reload(".pjax-reload")})});