function ajaxUpload(e,t){var a=$(e).data("options")?$(e).data("options"):$(e).attr("data-options");deleteAjaxUrl=decodeURIComponent(a.deleteUrl);var r=a.maxNumberOfFiles;if(e.files.length>r)return void layer.alert("最多上传"+r+"个文件",{icon:0});var i=!0;for(var n in e.files){var l=e.files[n];void 0!=l&&""!=l&&null!=l&&0!=l.length&&"function"!=typeof l&&l instanceof Object&&!(i=_fileUpload(l,a,t,e))&&layer.alert(l.name+"上传失败",{icon:0})}return $(e).val(""),i}function in_array(e,t){for(var a=0;a<t.length;a++)if(e==_trim(t[a].toLowerCase()))return!0;return!1}function _fileUpload(e,t,a,r){var i=($(r).parent("div.upload-kit-input").parent("div").parent("div").parent("form"),new FormData),n=t.url,l=r.getAttribute("name"),o=t.hiddenInputId,d=(t.onlyImage,t.maxNumberOfFiles,t.acceptFileTypes),p=d.split(","),s=!0,f=t.many;if(i.append(l,e),!e)return layer.alert("请选择文件",{icon:0}),!1;if(d=_trim(d),""!=d&&void 0!=d&&null!=d)if("image/*"==d){if(!/image\/\w+/.test(e.type))return layer.alert("请选择图片",{icon:0}),!1}else if(!in_array(e.type,p))return layer.alert("请选择正确的图片格式(jpg,jpeg,png,gif,bmp)",{icon:0}),!1;return jcms.ajax("POST",n,i,"JSON",function(e){if(e){if(200!==e.statusCode)return s=!1,layer.alert(e.stateInfo,{icon:5}),!1;_createImg(a,e,o,f)}else s=!1},!0,1e4,!0,function(e,t,a){200!==e.status&&(s=!1,layer.alert(e.status+"<br>"+e.readyState+"<br>"+t,{icon:5}))}),s}function _createImg(e,t,a,r){var i,n,l;t.fullname&&(i=t.fullname),t.path&&(i=t.path);var o=t.url?t.url:t.url;if(t&&i&&o){if(t.error)return void layer.alert(t.error);var d=document.getElementById(e),p=document.createElement("div");t.attachment_id&&(n=t.attachment_id),t.id&&(n=t.id),t.mimeType&&(l=t.mimeType),t.filetype&&(l=t.filetype),$(p).addClass("upload-kit-item done"),p.style.cssFloat="left";var s=new Image;if(s.style.width="150px",s.style.height="150px",$(p).append("<span class='fa fa-trash remove' data-id =' "+n+"' onclick='removeFile(this)' data-temp =' "+a+"' data-resid  = ' "+e+" '></span>"),/image\/\w+/.test(l)?s.src=o:s.src="/static/img/file.png",p.appendChild(s),d.parentNode.insertBefore(p,d),r){var f=$("#"+a).val();$("#"+a).val(f+i+"、")}else $("#"+a).val(i),d.style.display="none"}}function _trim(e){return e.replace(/^\s+|\s+$/gm,"")}var deleteAjaxUrl="";$(document).ready(function(){var e=$(".upload-kit-input").find("input[type='file']:eq(0)");if(e.length){var t=e.data("options")?e.data("options"):e.attr("data-options");deleteAjaxUrl=decodeURIComponent(t.deleteUrl);var a=t.files;if(a.length)for(var r in a){var i=a[r],n=$(".upload-kit-input").attr("id");_createImg(n,i,t.hiddenInputId,t.many)}}});var removeFile=function(e){var t=parseInt($(e).data("id")?$(e).data("id"):$(e).attr("data-id")),a=$(e).data("temp")?$(e).data("temp"):$(e).attr("data-temp");a=_trim(a);var r=$(e).data("resid")?$(e).data("resid"):$(e).attr("data-resid");console.log(a);var i=$("#"+a).val(),n=layer.confirm("删除不可恢复，确定要删除吗?",{bth:["确定","取消"]},function(n){jcms.ajax("POST",deleteAjaxUrl,{fileId:t,filepath:i},"JSON",function(t){200==t.code&&($(e).parent().remove(),$("#"+_trim(a)).val(""),$("#"+_trim(r)).show())}),layer.close(n)},function(){layer.close(n)})};